<div class="admin-book-form">
  <div class="header">
    <h2>{{ isEditMode ? "Kitap Düzenle" : "Yeni Kitap Ekle" }}</h2>
    <button class="btn btn-secondary" (click)="goBack()">
      <i class="bi bi-arrow-left me-2"></i>Geri Dön
    </button>
  </div>

  <div class="text-center my-5" *ngIf="loading">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Yükleniyor...</span>
    </div>
  </div>

  <form [formGroup]="bookForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
    <div class="row">
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">
            <h5>Temel Bilgiler</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="title" class="form-label">Kitap Adı *</label>
              <input
                type="text"
                id="title"
                formControlName="title"
                class="form-control"
              />
            </div>
            <div class="mb-3">
              <label for="author" class="form-label">Yazar *</label>
              <input
                type="text"
                id="author"
                formControlName="author"
                class="form-control"
              />
            </div>
            <div class="mb-3">
              <label for="isbn" class="form-label">ISBN *</label>
              <input
                type="text"
                id="isbn"
                formControlName="isbn"
                class="form-control"
              />
            </div>
            <div class="mb-3">
              <label for="publishedDate" class="form-label"
                >Yayın Tarihi *</label
              >
              <input
                type="date"
                id="publishedDate"
                formControlName="publishedDate"
                class="form-control"
              />
            </div>
            <div class="mb-3">
              <label for="description" class="form-label">Açıklama</label>
              <textarea
                id="description"
                formControlName="description"
                class="form-control"
                rows="5"
              ></textarea>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="price" class="form-label">Fiyat (₺) *</label>
                <input
                  type="number"
                  id="price"
                  formControlName="price"
                  class="form-control"
                  step="0.01"
                  min="0"
                />
              </div>
              <div class="col-md-6 mb-3">
                <label for="stockQuantity" class="form-label"
                  >Stok Miktarı *</label
                >
                <input
                  type="number"
                  id="stockQuantity"
                  formControlName="stockQuantity"
                  class="form-control"
                  min="0"
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card mb-4">
          <div class="card-header">
            <h5>Kategoriler</h5>
          </div>
          <div class="card-body scrollable-list">
            <div *ngFor="let category of categories" class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                [value]="category.id"
                [checked]="selectedCategoryIds.includes(category.id)"
                (change)="onCategoryChange(category.id, $event)"
              />
              <label class="form-check-label">{{ category.name }}</label>
            </div>
          </div>
        </div>

        <div class="card mb-4">
          <div class="card-header">
            <h5>Yayınevleri</h5>
          </div>
          <div class="card-body scrollable-list">
            <div *ngFor="let publisher of publishers" class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                [value]="publisher.id"
                [checked]="selectedPublisherIds.includes(publisher.id)"
                (change)="onPublisherChange(publisher.id, $event)"
              />
              <label class="form-check-label">{{ publisher.name }}</label>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h5>Kitap Resmi</h5>
          </div>
          <div class="card-body">
            <div class="mb-3" *ngIf="currentImageUrl">
              <img
                [src]="currentImageUrl"
                alt="Mevcut Resim"
                class="img-fluid rounded"
                style="max-height: 200px"
              />
            </div>
            <div class="mb-3">
              <input
                type="file"
                class="form-control"
                accept="image/*"
                (change)="onImageSelected($event)"
              />
              <small class="text-muted"
                >Yeni bir resim seçerseniz, "Resmi Güncelle" butonuna
                tıklayın.</small
              >
            </div>
            <div *ngIf="selectedImageFile && isEditMode">
              <button
                type="button"
                class="btn btn-info"
                [disabled]="submittingImage"
                (click)="updateBookImage()"
              >
                <span
                  *ngIf="submittingImage"
                  class="spinner-border spinner-border-sm me-2"
                  role="status"
                  aria-hidden="true"
                ></span>
                <span *ngIf="submittingImage">Resim Güncelleniyor...</span>
                <span *ngIf="!submittingImage">Resmi Güncelle</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-actions mt-4">
      <button type="button" class="btn btn-secondary me-2" (click)="goBack()">
        İptal
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="bookForm.invalid || submitting"
      >
        <span
          *ngIf="submitting"
          class="spinner-border spinner-border-sm me-2"
          role="status"
          aria-hidden="true"
        ></span>
        <span *ngIf="submitting">{{
          isEditMode ? "Güncelleniyor..." : "Kaydediliyor..."
        }}</span>
        <span *ngIf="!submitting">{{
          isEditMode ? "Güncelle" : "Kaydet"
        }}</span>
      </button>
    </div>
  </form>
</div>
